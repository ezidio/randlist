<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Descrição</th>
      <th width="110">Quantidade</th>
      <th width="40"></th>
      <th>
        Filtro
        <i class="glyphicon glyphicon-info-sign"
          uib-tooltip="{{sweepstakes.head.join(', ')}}">
        </i>
      </th>
      <th width="90"></th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="sweepstake in sweepstakes.list"
      ng-init="executed = sweepstakes.executed(sweepstake.uuid)">
      <td>
        <input type="text"
          class="form-control input-sm expression"
          placeholder="O que será sorteado?"
          ng-model="sweepstake.name"
          ng-change="sweepstakes.save(sweepstake)"
          ng-model-options="{
            updateOn: 'default blur',
            debounce: {
              'default': 1000,
              'blur': 0
            }
          }">
      </td>
      <td>
        <input type="number"
          class="form-control input-sm expression"
          placeholder="Quantos?"
          min="1"
          ng-model="sweepstake.quantity"
          ng-change="sweepstakes.save(sweepstake)"
          ng-model-options="{
            updateOn: 'default blur',
            debounce: {
              'default': 1000,
              'blur': 0
            }
          }">
      </td>
      <td>
        <span class="btn btn-success btn-block btn-sm"
          ng-class="{
            'btn-success': (executed < sweepstake.quantity),
            'btn-warning': (executed == sweepstake.quantity),
            'btn-danger': (executed > sweepstake.quantity)
          }">
          {{executed}}
        </span>
      </td>
      <td>
        <div class="input-group input-group-sm"
          uib-popover="{{sweepstakes.validateFilter(sweepstake.filter).error}}"
          popover-is-open="!sweepstakes.validateFilter(sweepstake.filter).valid"
          popover-placement="bottom-left"
          popover-trigger="'none'">
          <input type="text"
            class="form-control expression"
            placeholder="Utilize JS se quiser filtrar :)"
            ng-model="sweepstake.filter"
            ng-change="sweepstakes.save(sweepstake)"
            ng-model-options="{
              updateOn: 'default blur',
              debounce: {
                'default': 100,
                'blur': 0
              }
            }">
          <span class="badge filter-quantity">
            {{sweepstakes.resultFilter(sweepstake.filter).length}}
          </span>
          <span class="input-group-btn">
            <button type="button"
              class="btn btn-default"
              ng-click="sweepstakes.openFilter(sweepstake.filter)">
              <i class="glyphicon glyphicon-eye-open"></i>
            </button>
          </span>
        </div>
      </td>
      <td>
        <a class="btn btn-primary btn-sm"
          ng-href="#/sweepstakes/{{sweepstake.uuid}}">
          <i class="glyphicon glyphicon-list"></i>
        </a>
        <button type="button"
          class="btn btn-danger btn-sm"
          ng-click="sweepstakes.remove(sweepstake)"
          ng-disabled="executed">
          <i class="glyphicon glyphicon-remove"></i>
        </button>
      </td>
    </tr>
    <tr>
      <td>
        <input type="text"
          class="form-control input-sm expression"
          placeholder="O que será sorteado?"
          ng-model="name">
      </td>
      <td>
        <input type="number"
          class="form-control input-sm expression"
          placeholder="Quantos?"
          ng-model="quantity"
          min="1">
      </td>
      <td>
        <span class="btn btn-default btn-block btn-sm">0</span>
      </td>
      <td>
        <div class="input-group input-group-sm"
          uib-popover="{{sweepstakes.validateFilter(filter).error}}"
          popover-is-open="!sweepstakes.validateFilter(filter).valid"
          popover-placement="bottom-left"
          popover-trigger="'none'">
          <input type="text"
            class="form-control input-sm expression"
            placeholder="Utilize JS se quiser filtrar :)"
            ng-model="filter">
          <span class="badge filter-quantity">
            {{sweepstakes.resultFilter(filter).length}}
          </span>
          <span class="input-group-btn">
            <button type="button"
              class="btn btn-default"
              ng-click="sweepstakes.openFilter(filter)">
              <i class="glyphicon glyphicon-eye-open"></i>
            </button>
          </span>
        </div>
      </td>
      <td>
        <button type="button"
          class="btn btn-success btn-sm"
          ng-disabled="sweepstakesForm.$invalid"
          ng-click="sweepstakes.add(name, quantity, filter);
            name = quantity = filter = null">
          <i class="glyphicon glyphicon-ok"></i>
        </button>
        <button type="button"
          class="btn btn-danger btn-sm"
          disabled>
          <i class="glyphicon glyphicon-remove"></i>
        </button>
      </td>
    </tr>
  </tbody>
</table>

<script type="text/ng-template" id="resultFilter.html">
  <div class="modal-header">
    <button type="button"
      class="close"
      ng-click="$close()">
      <span aria-hidden="true">&times;</span>
    </button>
    <h3 class="modal-title expression">{{filter}}</h3>
  </div>
  <div class="modal-body">
    <table class="table table-condensed table-striped table-hover no-margin">
      <thead>
        <tr>
          <th width="20">
            #
          </th>
          <th ng-repeat="column in head">
            {{::column}}
          </th>
        </tr>
      </thead>
      <tbody ng-init="limit = 8">
        <tr ng-repeat="rows in body | limitTo:limit">
          <td>
            <strong>{{::$index+1}}</strong>
          </td>
          <td ng-repeat="cell in rows.data track by $index">
            {{::cell}}
          </td>
        </tr>
        <tr ng-if="body.length > limit">
          <td colspan="{{head.length+1}}">
          ...
          </td>
        </tr>
        <tr ng-if="body.length > limit">
          <td>
            <strong>{{body.length}}</strong>
          </td>
          <td ng-repeat="cell in body[body.length-1].data track by $index">
            {{::cell}}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</script>
